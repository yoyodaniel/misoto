//
//  UnitTranslationService.swift
//  Misoto
//
//  Service for translating cooking units to user's selected language
//

import Foundation

@MainActor
class UnitTranslationService {
    
    /// Translate a unit from English to the target language
    /// - Parameters:
    ///   - unit: The unit in English (e.g., "tsp", "tablespoon", "cup")
    ///   - targetLanguageCode: Target language code (e.g., "nl", "es", "fr", "zh-Hans", "zh-Hant")
    /// - Returns: Translated unit in target language
    static func translateUnit(_ unit: String, to targetLanguageCode: String) -> String {
        // Normalize the unit to lowercase for lookup
        let normalizedUnit = unit.lowercased().trimmingCharacters(in: .whitespaces)
        
        // If empty or already in target language, return as-is
        if normalizedUnit.isEmpty || targetLanguageCode.lowercased() == "en" || targetLanguageCode.lowercased().hasPrefix("en-") {
            return unit
        }
        
        // Normalize language code for lookup (handle zh-Hans, zh-Hant -> zh)
        var lookupCode = targetLanguageCode.lowercased()
        if lookupCode.hasPrefix("zh") {
            lookupCode = "zh"
        }
        
        // Get the translation map for the target language
        guard let translations = unitTranslations[lookupCode] else {
            // If language not found, return original
            print("⚠️ UnitTranslationService: No translations found for language code: \(lookupCode)")
            return unit
        }
        
        // Try exact match first
        if let translated = translations[normalizedUnit] {
            print("✅ UnitTranslationService: Translated '\(unit)' -> '\(translated)' for language \(lookupCode)")
            return translated
        }
        
        // Try matching without plural/singular variations
        let baseUnit = normalizedUnit
            .replacingOccurrences(of: "s$", with: "", options: .regularExpression) // Remove trailing 's'
        
        if let translated = translations[baseUnit] {
            print("✅ UnitTranslationService: Translated '\(unit)' -> '\(translated)' for language \(lookupCode) (via base unit)")
            return translated
        }
        
        // If no translation found, return original
        print("⚠️ UnitTranslationService: No translation found for unit '\(unit)' (normalized: '\(normalizedUnit)') in language \(lookupCode)")
        return unit
    }
    
    /// Unit translations for all supported languages
    private static let unitTranslations: [String: [String: String]] = [
        // Dutch (nl)
        "nl": [
            "tsp": "tl",
            "teaspoon": "theelepel",
            "teaspoons": "theelepels",
            "tbsp": "el",
            "tablespoon": "eetlepel",
            "tablespoons": "eetlepels",
            "cup": "kopje",
            "cups": "kopjes",
            "oz": "oz",
            "ounce": "ons",
            "ounces": "ons",
            "fl_oz": "vloeistof ons",
            "lb": "pond",
            "pound": "pond",
            "pounds": "ponden",
            "g": "gram",
            "gram": "gram",
            "grams": "gram",
            "kg": "kilogram",
            "kilogram": "kilogram",
            "kilograms": "kilogrammen",
            "ml": "milliliter",
            "milliliter": "milliliter",
            "milliliters": "milliliters",
            "l": "liter",
            "liter": "liter",
            "liters": "liters",
            "pinch": "mespuntje",
            "pinches": "mespuntjes",
            "dash": "scheutje",
            "dashes": "scheutjes",
            "piece": "stuk",
            "pieces": "stukken",
            "pcs": "stukken",
            "pc": "stuk",
            "slice": "plak",
            "slices": "plakken",
            "clove": "teen",
            "cloves": "tenen",
            "bunch": "bos",
            "bunches": "bossen",
            "head": "kop",
            "heads": "koppen",
            "strand": "streng",
            "strands": "strengen"
        ],
        
        // Spanish (es)
        "es": [
            "tsp": "cdta",
            "teaspoon": "cucharadita",
            "teaspoons": "cucharaditas",
            "tbsp": "cda",
            "tablespoon": "cucharada",
            "tablespoons": "cucharadas",
            "cup": "taza",
            "cups": "tazas",
            "oz": "oz",
            "ounce": "onza",
            "ounces": "onzas",
            "fl_oz": "onza líquida",
            "lb": "lb",
            "pound": "libra",
            "pounds": "libras",
            "g": "gramo",
            "gram": "gramo",
            "grams": "gramos",
            "kg": "kilogramo",
            "kilogram": "kilogramo",
            "kilograms": "kilogramos",
            "ml": "mililitro",
            "milliliter": "mililitro",
            "milliliters": "mililitros",
            "l": "litro",
            "liter": "litro",
            "liters": "litros",
            "pinch": "pizca",
            "pinches": "pizcas",
            "dash": "chorrito",
            "dashes": "chorritos",
            "piece": "pieza",
            "pieces": "piezas",
            "pcs": "piezas",
            "pc": "pieza",
            "slice": "rodaja",
            "slices": "rodajas",
            "clove": "diente",
            "cloves": "dientes",
            "bunch": "manojo",
            "bunches": "manojos",
            "head": "cabeza",
            "heads": "cabezas",
            "strand": "hebra",
            "strands": "hebras"
        ],
        
        // French (fr)
        "fr": [
            "tsp": "c. à café",
            "teaspoon": "cuillère à café",
            "teaspoons": "cuillères à café",
            "tbsp": "c. à soupe",
            "tablespoon": "cuillère à soupe",
            "tablespoons": "cuillères à soupe",
            "cup": "tasse",
            "cups": "tasses",
            "oz": "oz",
            "ounce": "once",
            "ounces": "onces",
            "fl_oz": "once liquide",
            "lb": "lb",
            "pound": "livre",
            "pounds": "livres",
            "g": "gramme",
            "gram": "gramme",
            "grams": "grammes",
            "kg": "kilogramme",
            "kilogram": "kilogramme",
            "kilograms": "kilogrammes",
            "ml": "millilitre",
            "milliliter": "millilitre",
            "milliliters": "millilitres",
            "l": "litre",
            "liter": "litre",
            "liters": "litres",
            "pinch": "pincée",
            "pinches": "pincées",
            "dash": "filet",
            "dashes": "filets",
            "piece": "morceau",
            "pieces": "morceaux",
            "pc": "morceau",
            "pcs": "morceaux",
            "slice": "tranche",
            "slices": "tranches",
            "clove": "gousse",
            "cloves": "gousses",
            "bunch": "bouquet",
            "bunches": "bouquets",
            "head": "tête",
            "heads": "têtes",
            "strand": "brin",
            "strands": "brins"
        ],
        
        // German (de)
        "de": [
            "tsp": "TL",
            "teaspoon": "Teelöffel",
            "teaspoons": "Teelöffel",
            "tbsp": "EL",
            "tablespoon": "Esslöffel",
            "tablespoons": "Esslöffel",
            "cup": "Tasse",
            "cups": "Tassen",
            "oz": "oz",
            "ounce": "Unze",
            "ounces": "Unzen",
            "fl_oz": "Flüssigunze",
            "lb": "lb",
            "pound": "Pfund",
            "pounds": "Pfund",
            "g": "Gramm",
            "gram": "Gramm",
            "grams": "Gramm",
            "kg": "Kilogramm",
            "kilogram": "Kilogramm",
            "kilograms": "Kilogramm",
            "ml": "Milliliter",
            "milliliter": "Milliliter",
            "milliliters": "Milliliter",
            "l": "Liter",
            "liter": "Liter",
            "liters": "Liter",
            "pinch": "Prise",
            "pinches": "Prisen",
            "dash": "Spritzer",
            "dashes": "Spritzer",
            "piece": "Stück",
            "pieces": "Stücke",
            "pc": "Stück",
            "pcs": "Stücke",
            "slice": "Scheibe",
            "slices": "Scheiben",
            "clove": "Zehe",
            "cloves": "Zehen",
            "bunch": "Bund",
            "bunches": "Bünde",
            "head": "Kopf",
            "heads": "Köpfe",
            "strand": "Strang",
            "strands": "Stränge"
        ],
        
        // Italian (it)
        "it": [
            "tsp": "cucchiaino",
            "teaspoon": "cucchiaino",
            "teaspoons": "cucchiaini",
            "tbsp": "cucchiaio",
            "tablespoon": "cucchiaio",
            "tablespoons": "cucchiai",
            "cup": "tazza",
            "cups": "tazze",
            "oz": "oz",
            "ounce": "oncia",
            "ounces": "once",
            "fl_oz": "oncia liquida",
            "lb": "lb",
            "pound": "libbra",
            "pounds": "libbre",
            "g": "grammo",
            "gram": "grammo",
            "grams": "grammi",
            "kg": "chilogrammo",
            "kilogram": "chilogrammo",
            "kilograms": "chilogrammi",
            "ml": "millilitro",
            "milliliter": "millilitro",
            "milliliters": "millilitri",
            "l": "litro",
            "liter": "litro",
            "liters": "litri",
            "pinch": "pizzico",
            "pinches": "pizzichi",
            "dash": "spruzzo",
            "dashes": "spruzzi",
            "piece": "pezzo",
            "pieces": "pezzi",
            "pc": "pezzo",
            "pcs": "pezzi",
            "slice": "fetta",
            "slices": "fette",
            "clove": "spicchio",
            "cloves": "spicchi",
            "bunch": "mazzo",
            "bunches": "mazzi",
            "head": "testa",
            "heads": "teste",
            "strand": "filo",
            "strands": "fili"
        ],
        
        // Portuguese (pt)
        "pt": [
            "tsp": "colher de chá",
            "teaspoon": "colher de chá",
            "teaspoons": "colheres de chá",
            "tbsp": "colher de sopa",
            "tablespoon": "colher de sopa",
            "tablespoons": "colheres de sopa",
            "cup": "xícara",
            "cups": "xícaras",
            "oz": "oz",
            "ounce": "onça",
            "ounces": "onças",
            "fl_oz": "onça fluida",
            "lb": "lb",
            "pound": "libra",
            "pounds": "libras",
            "g": "grama",
            "gram": "grama",
            "grams": "gramas",
            "kg": "quilograma",
            "kilogram": "quilograma",
            "kilograms": "quilogramas",
            "ml": "mililitro",
            "milliliter": "mililitro",
            "milliliters": "mililitros",
            "l": "litro",
            "liter": "litro",
            "liters": "litros",
            "pinch": "pitada",
            "pinches": "pitadas",
            "dash": "fio",
            "dashes": "fios",
            "piece": "peça",
            "pieces": "peças",
            "pc": "peça",
            "pcs": "peças",
            "slice": "fatia",
            "slices": "fatias",
            "clove": "dente",
            "cloves": "dentes",
            "bunch": "maço",
            "bunches": "maços",
            "head": "cabeça",
            "heads": "cabeças",
            "strand": "fio",
            "strands": "fios"
        ],
        
        // Russian (ru)
        "ru": [
            "tsp": "ч.л.",
            "teaspoon": "чайная ложка",
            "teaspoons": "чайные ложки",
            "tbsp": "ст.л.",
            "tablespoon": "столовая ложка",
            "tablespoons": "столовые ложки",
            "cup": "чашка",
            "cups": "чашки",
            "oz": "унция",
            "ounce": "унция",
            "ounces": "унции",
            "fl_oz": "жидкая унция",
            "lb": "фунт",
            "pound": "фунт",
            "pounds": "фунты",
            "g": "грамм",
            "gram": "грамм",
            "grams": "граммы",
            "kg": "килограмм",
            "kilogram": "килограмм",
            "kilograms": "килограммы",
            "ml": "миллилитр",
            "milliliter": "миллилитр",
            "milliliters": "миллилитры",
            "l": "литр",
            "liter": "литр",
            "liters": "литры",
            "pinch": "щепотка",
            "pinches": "щепотки",
            "dash": "капля",
            "dashes": "капли",
            "piece": "штука",
            "pieces": "штуки",
            "pc": "шт",
            "pcs": "шт",
            "slice": "ломтик",
            "slices": "ломтики",
            "clove": "зубчик",
            "cloves": "зубчики",
            "bunch": "пучок",
            "bunches": "пучки",
            "head": "головка",
            "heads": "головки",
            "strand": "прядь",
            "strands": "пряди"
        ],
        
        // Japanese (ja)
        "ja": [
            "tsp": "小さじ",
            "teaspoon": "小さじ",
            "teaspoons": "小さじ",
            "tbsp": "大さじ",
            "tablespoon": "大さじ",
            "tablespoons": "大さじ",
            "cup": "カップ",
            "cups": "カップ",
            "oz": "オンス",
            "ounce": "オンス",
            "ounces": "オンス",
            "fl_oz": "液量オンス",
            "lb": "ポンド",
            "pound": "ポンド",
            "pounds": "ポンド",
            "g": "グラム",
            "gram": "グラム",
            "grams": "グラム",
            "kg": "キログラム",
            "kilogram": "キログラム",
            "kilograms": "キログラム",
            "ml": "ミリリットル",
            "milliliter": "ミリリットル",
            "milliliters": "ミリリットル",
            "l": "リットル",
            "liter": "リットル",
            "liters": "リットル",
            "pinch": "ひとつまみ",
            "pinches": "ひとつまみ",
            "dash": "少々",
            "dashes": "少々",
            "piece": "個",
            "pieces": "個",
            "pc": "個",
            "pcs": "個",
            "slice": "切れ",
            "slices": "切れ",
            "clove": "片",
            "cloves": "片",
            "bunch": "束",
            "bunches": "束",
            "head": "個",
            "heads": "個",
            "strand": "本",
            "strands": "本"
        ],
        
        // Korean (ko)
        "ko": [
            "tsp": "작은 술",
            "teaspoon": "작은 술",
            "teaspoons": "작은 술",
            "tbsp": "큰 술",
            "tablespoon": "큰 술",
            "tablespoons": "큰 술",
            "cup": "컵",
            "cups": "컵",
            "oz": "온스",
            "ounce": "온스",
            "ounces": "온스",
            "fl_oz": "액량 온스",
            "lb": "파운드",
            "pound": "파운드",
            "pounds": "파운드",
            "g": "그램",
            "gram": "그램",
            "grams": "그램",
            "kg": "킬로그램",
            "kilogram": "킬로그램",
            "kilograms": "킬로그램",
            "ml": "밀리리터",
            "milliliter": "밀리리터",
            "milliliters": "밀리리터",
            "l": "리터",
            "liter": "리터",
            "liters": "리터",
            "pinch": "한 꼬집",
            "pinches": "한 꼬집",
            "dash": "조금",
            "dashes": "조금",
            "piece": "개",
            "pieces": "개",
            "pc": "개",
            "pcs": "개",
            "slice": "조각",
            "slices": "조각",
            "clove": "쪽",
            "cloves": "쪽",
            "bunch": "단",
            "bunches": "단",
            "head": "통",
            "heads": "통",
            "strand": "줄",
            "strands": "줄"
        ],
        
        // Chinese Simplified (zh-Hans)
        "zh": [
            "tsp": "茶匙",
            "teaspoon": "茶匙",
            "teaspoons": "茶匙",
            "tbsp": "汤匙",
            "tablespoon": "汤匙",
            "tablespoons": "汤匙",
            "cup": "杯",
            "cups": "杯",
            "oz": "盎司",
            "ounce": "盎司",
            "ounces": "盎司",
            "fl_oz": "液量盎司",
            "lb": "磅",
            "pound": "磅",
            "pounds": "磅",
            "g": "克",
            "gram": "克",
            "grams": "克",
            "kg": "千克",
            "kilogram": "千克",
            "kilograms": "千克",
            "ml": "毫升",
            "milliliter": "毫升",
            "milliliters": "毫升",
            "l": "升",
            "liter": "升",
            "liters": "升",
            "pinch": "撮",
            "pinches": "撮",
            "dash": "少许",
            "dashes": "少许",
            "piece": "个",
            "pieces": "个",
            "pc": "个",
            "pcs": "个",
            "slice": "片",
            "slices": "片",
            "clove": "瓣",
            "cloves": "瓣",
            "bunch": "束",
            "bunches": "束",
            "head": "头",
            "heads": "头",
            "strand": "缕",
            "strands": "缕"
        ],
        
        // Thai (th)
        "th": [
            "tsp": "ชช.",
            "teaspoon": "ช้อนชา",
            "teaspoons": "ช้อนชา",
            "tbsp": "ชต.",
            "tablespoon": "ช้อนโต๊ะ",
            "tablespoons": "ช้อนโต๊ะ",
            "cup": "ถ้วย",
            "cups": "ถ้วย",
            "oz": "ออนซ์",
            "ounce": "ออนซ์",
            "ounces": "ออนซ์",
            "fl_oz": "ออนซ์ของเหลว",
            "lb": "ปอนด์",
            "pound": "ปอนด์",
            "pounds": "ปอนด์",
            "g": "กรัม",
            "gram": "กรัม",
            "grams": "กรัม",
            "kg": "กิโลกรัม",
            "kilogram": "กิโลกรัม",
            "kilograms": "กิโลกรัม",
            "ml": "มิลลิลิตร",
            "milliliter": "มิลลิลิตร",
            "milliliters": "มิลลิลิตร",
            "l": "ลิตร",
            "liter": "ลิตร",
            "liters": "ลิตร",
            "pinch": "หยิบ",
            "pinches": "หยิบ",
            "dash": "หยด",
            "dashes": "หยด",
            "piece": "ชิ้น",
            "pieces": "ชิ้น",
            "pc": "ชิ้น",
            "pcs": "ชิ้น",
            "slice": "ชิ้น",
            "slices": "ชิ้น",
            "clove": "กลีบ",
            "cloves": "กลีบ",
            "bunch": "กำ",
            "bunches": "กำ",
            "head": "หัว",
            "heads": "หัว",
            "strand": "เส้น",
            "strands": "เส้น"
        ],
        
        // Vietnamese (vi)
        "vi": [
            "tsp": "thìa cà phê",
            "teaspoon": "thìa cà phê",
            "teaspoons": "thìa cà phê",
            "tbsp": "thìa canh",
            "tablespoon": "thìa canh",
            "tablespoons": "thìa canh",
            "cup": "cốc",
            "cups": "cốc",
            "oz": "ounce",
            "ounce": "ounce",
            "ounces": "ounce",
            "fl_oz": "ounce chất lỏng",
            "lb": "pound",
            "pound": "pound",
            "pounds": "pound",
            "g": "gam",
            "gram": "gam",
            "grams": "gam",
            "kg": "kilogram",
            "kilogram": "kilogram",
            "kilograms": "kilogram",
            "ml": "mililit",
            "milliliter": "mililit",
            "milliliters": "mililit",
            "l": "lít",
            "liter": "lít",
            "liters": "lít",
            "pinch": "nhúm",
            "pinches": "nhúm",
            "dash": "giọt",
            "dashes": "giọt",
            "piece": "cái",
            "pieces": "cái",
            "pc": "cái",
            "pcs": "cái",
            "slice": "lát",
            "slices": "lát",
            "clove": "tép",
            "cloves": "tép",
            "bunch": "bó",
            "bunches": "bó",
            "head": "củ",
            "heads": "củ",
            "strand": "sợi",
            "strands": "sợi"
        ],
        
        // Indonesian (id)
        "id": [
            "tsp": "sdt",
            "teaspoon": "sendok teh",
            "teaspoons": "sendok teh",
            "tbsp": "sdm",
            "tablespoon": "sendok makan",
            "tablespoons": "sendok makan",
            "cup": "cangkir",
            "cups": "cangkir",
            "oz": "ons",
            "ounce": "ons",
            "ounces": "ons",
            "fl_oz": "ons cair",
            "lb": "pon",
            "pound": "pon",
            "pounds": "pon",
            "g": "gram",
            "gram": "gram",
            "grams": "gram",
            "kg": "kilogram",
            "kilogram": "kilogram",
            "kilograms": "kilogram",
            "ml": "mililiter",
            "milliliter": "mililiter",
            "milliliters": "mililiter",
            "l": "liter",
            "liter": "liter",
            "liters": "liter",
            "pinch": "sejumput",
            "pinches": "sejumput",
            "dash": "sedikit",
            "dashes": "sedikit",
            "piece": "buah",
            "pieces": "buah",
            "pc": "buah",
            "pcs": "buah",
            "slice": "iris",
            "slices": "iris",
            "clove": "siung",
            "cloves": "siung",
            "bunch": "ikat",
            "bunches": "ikat",
            "head": "kepala",
            "heads": "kepala",
            "strand": "helai",
            "strands": "helai"
        ],
        
        // Malay (ms)
        "ms": [
            "tsp": "sudu teh",
            "teaspoon": "sudu teh",
            "teaspoons": "sudu teh",
            "tbsp": "sudu besar",
            "tablespoon": "sudu besar",
            "tablespoons": "sudu besar",
            "cup": "cawan",
            "cups": "cawan",
            "oz": "auns",
            "ounce": "auns",
            "ounces": "auns",
            "fl_oz": "auns cecair",
            "lb": "paun",
            "pound": "paun",
            "pounds": "paun",
            "g": "gram",
            "gram": "gram",
            "grams": "gram",
            "kg": "kilogram",
            "kilogram": "kilogram",
            "kilograms": "kilogram",
            "ml": "mililiter",
            "milliliter": "mililiter",
            "milliliters": "mililiter",
            "l": "liter",
            "liter": "liter",
            "liters": "liter",
            "pinch": "cubit",
            "pinches": "cubit",
            "dash": "sedikit",
            "dashes": "sedikit",
            "piece": "biji",
            "pieces": "biji",
            "pc": "biji",
            "pcs": "biji",
            "slice": "hiris",
            "slices": "hiris",
            "clove": "ulas",
            "cloves": "ulas",
            "bunch": "ikat",
            "bunches": "ikat",
            "head": "kepala",
            "heads": "kepala",
            "strand": "helai",
            "strands": "helai"
        ],
        
        // Filipino/Tagalog (fil)
        "fil": [
            "tsp": "kutsarita",
            "teaspoon": "kutsarita",
            "teaspoons": "kutsarita",
            "tbsp": "kutsara",
            "tablespoon": "kutsara",
            "tablespoons": "kutsara",
            "cup": "tasa",
            "cups": "tasa",
            "oz": "onsa",
            "ounce": "onsa",
            "ounces": "onsa",
            "fl_oz": "onsang likido",
            "lb": "libra",
            "pound": "libra",
            "pounds": "libra",
            "g": "gramo",
            "gram": "gramo",
            "grams": "gramo",
            "kg": "kilogramo",
            "kilogram": "kilogramo",
            "kilograms": "kilogramo",
            "ml": "mililitro",
            "milliliter": "mililitro",
            "milliliters": "mililitro",
            "l": "litro",
            "liter": "litro",
            "liters": "litro",
            "pinch": "kurot",
            "pinches": "kurot",
            "dash": "kaunti",
            "dashes": "kaunti",
            "piece": "piraso",
            "pieces": "piraso",
            "pc": "piraso",
            "pcs": "piraso",
            "slice": "hiwa",
            "slices": "hiwa",
            "clove": "sibuyas",
            "cloves": "sibuyas",
            "bunch": "bigkis",
            "bunches": "bigkis",
            "head": "ulo",
            "heads": "ulo",
            "strand": "hibla",
            "strands": "hibla"
        ],
        
        // Hindi (hi)
        "hi": [
            "tsp": "चम्मच",
            "teaspoon": "चम्मच",
            "teaspoons": "चम्मच",
            "tbsp": "बड़ा चम्मच",
            "tablespoon": "बड़ा चम्मच",
            "tablespoons": "बड़ा चम्मच",
            "cup": "कप",
            "cups": "कप",
            "oz": "औंस",
            "ounce": "औंस",
            "ounces": "औंस",
            "fl_oz": "तरल औंस",
            "lb": "पाउंड",
            "pound": "पाउंड",
            "pounds": "पाउंड",
            "g": "ग्राम",
            "gram": "ग्राम",
            "grams": "ग्राम",
            "kg": "किलोग्राम",
            "kilogram": "किलोग्राम",
            "kilograms": "किलोग्राम",
            "ml": "मिलीलीटर",
            "milliliter": "मिलीलीटर",
            "milliliters": "मिलीलीटर",
            "l": "लीटर",
            "liter": "लीटर",
            "liters": "लीटर",
            "pinch": "चुटकी",
            "pinches": "चुटकी",
            "dash": "बूंद",
            "dashes": "बूंद",
            "piece": "टुकड़ा",
            "pieces": "टुकड़े",
            "pc": "टुकड़ा",
            "pcs": "टुकड़े",
            "slice": "स्लाइस",
            "slices": "स्लाइस",
            "clove": "लौंग",
            "cloves": "लौंग",
            "bunch": "गुच्छा",
            "bunches": "गुच्छे",
            "head": "सिर",
            "heads": "सिर",
            "strand": "तार",
            "strands": "तार"
        ]
    ]
}

