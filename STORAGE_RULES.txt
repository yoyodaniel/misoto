rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Profile images - users can upload/update/delete their own profile image
    // Path format: profile_images/{userId}.jpg
    match /profile_images/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
        fileName.matches(request.auth.uid + '\\.jpg');
      allow delete: if request.auth != null && 
        fileName.matches(request.auth.uid + '\\.jpg');
    }
    
    // Recipe images - authenticated users can upload and delete
    // Support both recipe_images/ and recipes/ paths for backward compatibility
    match /recipe_images/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    match /recipes/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    // Instruction images/videos - authenticated users can upload and delete
    // Support multiple path formats: instruction_media/, recipe-instructions/, instructions/
    match /instruction_media/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    match /recipe-instructions/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    match /instructions/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    // Source images - authenticated users can upload and delete
    match /source-images/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
  }
}

